!function(t){"use strict";function e(){return this instanceof e?(this._onSuccess=[],void(this._onError=[])):new e}e.prototype.success=function(t){return this._onSuccess.push(t),this},e.prototype.fail=function(t){return this._onError.push(t),this},e.prototype.resolve=function(){for(var t;t=this._onSuccess.shift();)t.apply(this,arguments);return this},e.prototype.reject=function(){for(var t;t=this._onError.shift();)t.apply(this,arguments);return this},e.prototype.propagateTo=function(t){return this._onSuccess=this._onSuccess.concat(t._onSuccess),this._onError=this._onError.concat(t._onError),this},t.SNDAPI=t.SNDAPI||function(n){function r(){return{tokenIsSet:!!l.token,tokenTimerIsSet:!!l.tokenTimer}}function s(){if(!p.key)throw new Error("API key is required for SND API initalization");return l.tokenTimer&&clearInterval(l.tokenTimer),l.tokenTimer=setInterval(o,p.refreshInterval),o()}function o(){return u({sign:!1,url:p.signatureServiceUrl+"?api-key="+p.key}).success(function(t){var e;if(l.token=t.token,f.length)for(;e=f.shift();)u(e.options).propagateTo(e.result)}).fail(function(){})}function i(t,e){var n,r={},s=Object.hasOwnProperty;for(n in t)s.call(t,n)&&(r[n]=t[n]);if("object"==typeof e)for(n in e)s.call(e,n)&&(r[n]=e[n]);return r}function u(n){function r(){return"success"===c?d.resolve(h.response,h):d.reject(h)}var s=i({url:null,postData:null,preferJSON:!0,sign:!0},n),o=a(),u=s.postData?"POST":"GET",c=null,h={response:null},d=new e;return/^http/.test(s.url)||(s.url=p.prefixUrl+s.url),o?(d.req=o,!l.token&&s.sign?(f.push({options:s,result:d}),d):(o.open(u,s.url,!0),l.token&&s.sign&&o.setRequestHeader("X-Snd-Apisignature",l.token),s.postData&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.preferJSON&&o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){4===o.readyState&&(200!==o.status&&304!==o.status?(c="fail",h={statusCode:o.status,statusText:o.statusText,response:o.responseText}):(c="success",h={statusCode:o.status,statusText:o.statusText,response:o.responseText},o.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON&&(h.response=JSON.parse(h.response))),r())},4===o.readyState?(t.console&&t.console.warn("I did not expect to get here"),null):(o.send(s.postData),d))):(c="fail",d)}function a(){for(var t=!1,e=0;e<h.length;e++){try{t=h[e]()}catch(n){continue}break}return t}var c,p=i({refreshInterval:18e5,signatureServiceUrl:"https://api.snd.no/sts/signature",prefixUrl:"http://api.snd.no/news/v2/",key:null},n),l={token:null,tokenTimer:null},f=[],h=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return c={init:s,getState:r,ajax:u}}}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);