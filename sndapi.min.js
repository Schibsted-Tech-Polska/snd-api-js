!function(e){"use strict";e.SNDAPI=e.SNDAPI||function(t){function n(){return{tokenIsSet:!!l.token,tokenTimerIsSet:!!l.tokenTimer}}function r(){if(!c.key)throw new Error("API key is required for SND API initalization");return l.tokenTimer&&clearInterval(l.tokenTimer),l.tokenTimer=setInterval(s,c.refreshInterval),s()}function s(){return u({sign:!1,url:c.signatureServiceUrl+"?api-key="+c.key}).success(function(e){l.token=e.token}).fail(function(){})}function o(e,t){var n,r={},s=Object.hasOwnProperty;for(n in e)s.call(e,n)&&(r[n]=e[n]);if("object"==typeof t)for(n in t)s.call(t,n)&&(r[n]=t[n]);return r}function u(t){function n(){var e;if("success"===d)for(;e=p.pop();)e(T.response,T);else for(;e=f.pop();)e(T)}function r(){return d&&n(),k}var s=o({url:null,postData:null,preferJSON:!0,sign:!0},t),u=i(),a=s.postData?"POST":"GET",p=[],f=[],d=null,T={response:null},k={};return/^http/.test(s.url)||(s.url=c.prefixUrl+s.url),k.success=function(e){return p.push(e),r()},k.fail=function(e){return f.push(e),r()},u?(k.req=u,u.open(a,s.url,!0),l.token&&s.sign&&u.setRequestHeader("X-Snd-Apisignature",l.token),s.postData&&u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.preferJSON&&u.setRequestHeader("Accept","application/json"),u.onreadystatechange=function(){4===u.readyState&&(200!==u.status&&304!==u.status?(d="fail",T={statusCode:u.status,statusText:u.statusText,response:u.responseText}):(d="success",T={statusCode:u.status,statusText:u.statusText,response:u.responseText},u.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON&&(T.response=JSON.parse(T.response))),n())},4===u.readyState?void(e.console&&e.console.warn("I did not expect to get here")):(u.send(s.postData),k)):(d="fail",k)}function i(){for(var e=!1,t=0;t<p.length;t++){try{e=p[t]()}catch(n){continue}break}return e}var a,c=o({refreshInterval:18e5,signatureServiceUrl:"http://api.snd.no/sts/signature",prefixUrl:"http://api.snd.no/news/v2/",key:null},t),l={token:null,tokenTimer:null},p=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return a={init:r,getState:n,ajax:u}}}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);