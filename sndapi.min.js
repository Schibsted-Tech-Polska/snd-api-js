/**
 * sndapi-js - SND  news API client library to access the API from JavaScript
 * @version v0.4.1
 * @link https://bitbucket.org/schibstednorge/snd-api-js
 * @license BSD-2-Clause
 */
!function(t){"use strict";function e(){return this instanceof e?(this._onSuccess=[],this._onError=[],this._state=0,void(this._resolution=null)):new e}e.prototype.success=function(t){return this._onSuccess.push(t),this._refire(),this},e.prototype.fail=function(t){return this._onError.push(t),this._refire(),this},e.prototype.resolve=function(){var t,e=this._resolution||arguments;for(this._state=1,this._resolution=e;t=this._onSuccess.shift();)t.apply(this,e);return this},e.prototype.reject=function(){var t,e=this._resolution||arguments;for(this._state=2,this._resolution=e;t=this._onError.shift();)t.apply(this,e);return this},e.prototype.handleWith=function(t){return this._onSuccess.forEach(function(e){t._onSuccess.push(e)}),this._onError.forEach(function(e){t._onError.push(e)}),this._onSuccess=t._onSuccess,this._onError=t._onError,this._refire(),this},e.prototype._refire=function(){this._state>0&&(1===this._state?this.resolve():this.reject())},t.SNDAPI=t.SNDAPI||function(n){function r(){return{tokenIsSet:!!f.token,tokenTimerIsSet:!!f.tokenTimer}}function s(t){if(!l.key)throw new Error("API key is required for SND API initalization");return f.tokenTimer&&clearInterval(f.tokenTimer),f.tokenTimer=setInterval(o,l.refreshInterval),o(t)}function o(t){var e=i({async:!0},t);return e=i(e,{sign:!1,url:l.signatureServiceUrl+"?api-key="+l.key}),u(e).success(function(t){var e;if(f.token=t.token,p.length)for(;e=p.shift();)u(e.options).handleWith(e.result)}).fail(function(){})}function i(t,e){var n,r={},s=Object.hasOwnProperty;for(n in t)s.call(t,n)&&(r[n]=t[n]);if("object"==typeof e)for(n in e)s.call(e,n)&&(r[n]=e[n]);return r}function u(n){function r(){return clearTimeout(o._timeouter),"success"===c?d.resolve(h.response,h):d.reject(h)}var s=i({async:!0,url:null,postData:null,preferJSON:!0,sign:!0,timeout:3e4},n),o=a(),u=s.postData?"POST":"GET",c=null,h={response:null},d=new e;if(/^([a-z]+:)?\/\//.test(s.url)||(s.url=l.prefixUrl+s.url),!o)return c="fail",d;if(d.req=o,o._timeouter=setTimeout(function(){c="fail",h={statusCode:-1,statusText:"Request timed out",response:null},d.reject(h)},s.timeout),!f.token&&s.sign)return p.push({options:s,result:d}),d;if(o.open(u,s.url,s.async),f.token&&s.sign&&o.setRequestHeader("X-Snd-Apisignature",f.token),s.postData&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.preferJSON&&o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status&&304!==o.status)c="fail",h={statusCode:o.status,statusText:o.statusText,response:o.responseText};else if(c="success",h={statusCode:o.status,statusText:o.statusText,response:o.responseText},o.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON)try{h.response=JSON.parse(h.response)}catch(t){}r()}},4===o.readyState)return t.console&&t.console.warn("I did not expect to get here"),null;try{o.send(s.postData)}catch(y){c="fail",h={statusCode:y.code||0,statusText:y.message||"Error caught when trying to send request",response:y},r()}return d}function a(){for(var t=!1,e=0;e<h.length;e++){try{t=h[e]()}catch(n){continue}break}return t}var c,l=i({refreshInterval:18e5,signatureServiceUrl:"//api.snd.no/sts/signature",prefixUrl:"//api.snd.no/news/v2/",key:null},n),f={token:null,tokenTimer:null},p=[],h=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return c={init:s,getState:r,ajax:u}},t.SNDAPI.prototype.SchoenfinkelizedResult=e}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);