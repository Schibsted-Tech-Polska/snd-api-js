!function(t){"use strict";function e(){var t={_onSuccess:[],_onError:[]};return t}e.prototype.success=function(t){return this._onSuccess.push(t),this},e.prototype.fail=function(t){return this._onError.push(t),this},e.prototype.resolve=function(){for(var t;t=this._onSuccess.shift();)t.apply(this,arguments);return this},e.prototype.reject=function(){for(var t;t=this._onError.shift();)t.apply(this,arguments);return this},e.prototype.propagateTo=function(t){return this._onSuccess=this._onSuccess.concat(t._onSuccess),this._onError=this._onError.concat(t._onError),this},t.SNDAPI=t.SNDAPI||function(n){function r(){return{tokenIsSet:!!l.token,tokenTimerIsSet:!!l.tokenTimer}}function s(){if(!p.key)throw new Error("API key is required for SND API initalization");return l.tokenTimer&&clearInterval(l.tokenTimer),l.tokenTimer=setInterval(o,p.refreshInterval),o()}function o(){return i({sign:!1,url:p.signatureServiceUrl+"?api-key="+p.key}).success(function(t){var e;if(l.token=t.token,f.length)for(;e=f.shift();)i(e.options).propagateTo(e.result)}).fail(function(){})}function u(t,e){var n,r={},s=Object.hasOwnProperty;for(n in t)s.call(t,n)&&(r[n]=t[n]);if("object"==typeof e)for(n in e)s.call(e,n)&&(r[n]=e[n]);return r}function i(n){function r(){return"success"===h?(S.resolve(d.response,d),s()):(S.reject(d),s())}function s(){return h&&r(),S}var o=u({url:null,postData:null,preferJSON:!0,sign:!0},n),i=a(),c=o.postData?"POST":"GET",h=null,d={response:null},S=new e;return/^http/.test(o.url)||(o.url=p.prefixUrl+o.url),i?(S.req=i,!l.token&&o.sign?(f.push({options:o,result:S}),S):(i.open(c,o.url,!0),l.token&&o.sign&&i.setRequestHeader("X-Snd-Apisignature",l.token),o.postData&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.preferJSON&&i.setRequestHeader("Accept","application/json"),i.onreadystatechange=function(){4===i.readyState&&(200!==i.status&&304!==i.status?(h="fail",d={statusCode:i.status,statusText:i.statusText,response:i.responseText}):(h="success",d={statusCode:i.status,statusText:i.statusText,response:i.responseText},i.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON&&(d.response=JSON.parse(d.response))),r())},4===i.readyState?(t.console&&t.console.warn("I did not expect to get here"),null):(i.send(o.postData),S))):(h="fail",S)}function a(){for(var t=!1,e=0;e<h.length;e++){try{t=h[e]()}catch(n){continue}break}return t}var c,p=u({refreshInterval:18e5,signatureServiceUrl:"https://api.snd.no/sts/signature",prefixUrl:"http://api.snd.no/news/v2/",key:null},n),l={token:null,tokenTimer:null},f=[],h=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return c={init:s,getState:r,ajax:i}}}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);