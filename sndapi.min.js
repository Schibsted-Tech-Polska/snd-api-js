!function(e){"use strict";function t(){return this instanceof t?(this._onSuccess=[],void(this._onError=[])):new t}t.prototype.success=function(e){return this._onSuccess.push(e),this},t.prototype.fail=function(e){return this._onError.push(e),this},t.prototype.resolve=function(){for(var e;e=this._onSuccess.shift();)e.apply(this,arguments);return this},t.prototype.reject=function(){for(var e;e=this._onError.shift();)e.apply(this,arguments);return this},t.prototype.propagateTo=function(e){return this._onSuccess=this._onSuccess.concat(e._onSuccess),this._onError=this._onError.concat(e._onError),this},e.SNDAPI=e.SNDAPI||function(n){function r(){return{tokenIsSet:!!p.token,tokenTimerIsSet:!!p.tokenTimer}}function s(){if(!l.key)throw new Error("API key is required for SND API initalization");return p.tokenTimer&&clearInterval(p.tokenTimer),p.tokenTimer=setInterval(o,l.refreshInterval),o()}function o(){return u({sign:!1,url:l.signatureServiceUrl+"?api-key="+l.key}).success(function(e){var t;if(p.token=e.token,f.length)for(;t=f.shift();)u(t.options).propagateTo(t.result)}).fail(function(){})}function i(e,t){var n,r={},s=Object.hasOwnProperty;for(n in e)s.call(e,n)&&(r[n]=e[n]);if("object"==typeof t)for(n in t)s.call(t,n)&&(r[n]=t[n]);return r}function u(n){function r(){return"success"===c?d.resolve(h.response,h):d.reject(h)}var s=i({url:null,postData:null,preferJSON:!0,sign:!0},n),o=a(),u=s.postData?"POST":"GET",c=null,h={response:null},d=new t;return/^([a-z]+:)?\/\//.test(s.url)||(s.url=l.prefixUrl+s.url),o?(d.req=o,!p.token&&s.sign?(f.push({options:s,result:d}),d):(o.open(u,s.url,!0),p.token&&s.sign&&o.setRequestHeader("X-Snd-Apisignature",p.token),s.postData&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.preferJSON&&o.setRequestHeader("Accept","application/json"),o.onreadystatechange=function(){4===o.readyState&&(200!==o.status&&304!==o.status?(c="fail",h={statusCode:o.status,statusText:o.statusText,response:o.responseText}):(c="success",h={statusCode:o.status,statusText:o.statusText,response:o.responseText},o.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON&&(h.response=JSON.parse(h.response))),r())},4===o.readyState?(e.console&&e.console.warn("I did not expect to get here"),null):(o.send(s.postData),d))):(c="fail",d)}function a(){for(var e=!1,t=0;t<h.length;t++){try{e=h[t]()}catch(n){continue}break}return e}var c,l=i({refreshInterval:18e5,signatureServiceUrl:"//api.snd.no/sts/signature",prefixUrl:"//api.snd.no/news/v2/",key:null},n),p={token:null,tokenTimer:null},f=[],h=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return c={init:s,getState:r,ajax:u}}}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);