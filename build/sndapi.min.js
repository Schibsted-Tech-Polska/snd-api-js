!function(e){"use strict";e.SNDAPI=e.SNDAPI||function(e){function t(){return{tokenIsSet:!!c.token,tokenTimerIsSet:!!c.tokenTimer}}function n(){if(!a.key)throw new Error("API key is required for SND API initalization");return c.tokenTimer&&clearInterval(c.tokenTimer),c.tokenTimer=setInterval(r,a.refreshInterval),r()}function r(){return o({sign:!1,url:a.signatureServiceUrl+"?api-key="+a.key}).success(function(e){c.token=e.token}).fail(function(){})}function s(e,t){var n,r={},s=Object.hasOwnProperty;for(n in e)s.call(e,n)&&(r[n]=e[n]);if("object"==typeof t)for(n in t)s.call(t,n)&&(r[n]=t[n]);return r}function o(e){function t(){var e;if("success"===f)for(;e=l.pop();)e(d.response,d);else for(;e=p.pop();)e(d)}function n(){return f&&t(),T}var r=s({url:null,postData:null,preferJSON:!0,sign:!0},e),o=u(),i=r.postData?"POST":"GET",l=[],p=[],f=null,d={response:null},T={};return/^http/.test(r.url)||(r.url=a.prefixUrl+r.url),T.success=function(e){return l.push(e),n()},T.fail=function(e){return p.push(e),n()},o?(T.req=o,o.open(i,r.url,!0),c.token&&r.sign&&o.setRequestHeader("X-Snd-Apisignature",c.token),r.postData&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.preferJSON&&o.setRequestHeader("Accept","application/javascript, application/json"),o.onreadystatechange=function(){4===o.readyState&&(200!==o.status&&304!==o.status?(f="fail",d={statusCode:o.status,statusText:o.statusText,response:o.responseText}):(f="success",d={statusCode:o.status,statusText:o.statusText,response:o.responseText},o.getResponseHeader("Content-Type").match(/^application\/json/)&&JSON&&(d.response=JSON.parse(d.response))),t())},4===o.readyState?void(console&&console.warn("I did not expect to get here")):(o.send(r.postData),T)):(f="fail",T)}function u(){for(var e=!1,t=0;t<l.length;t++){try{e=l[t]()}catch(n){continue}break}return e}var i,a=s({refreshInterval:18e5,signatureServiceUrl:"http://api.snd.no/sts/signature",prefixUrl:"http://api.snd.no/news/v2/",key:null},e),c={token:null,tokenTimer:null},l=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return i={init:n,getState:t,ajax:o}}}("object"==typeof global?global:this),"undefined"!=typeof module&&module.exports&&(module.exports=SNDAPI);