var SNDAPI=SNDAPI||function(e){"use strict";function t(){if(!a.key)throw new Error("API key is required for SND API initalization");n(),c.tokenTimer&&clearInterval(c.tokenTimer),c.tokenTimer=setInterval(n,a.refreshInterval)}function n(){s({sign:!1,url:a.signatureServiceUrl+"?api-key="+a.key}).success(function(e,t){c.token=e.token,l("token: "+c.token),l(t)}).fail(function(e){f(e)})}function o(e,t){var n,o={},s=Object.hasOwnProperty;for(n in e)s.call(e,n)&&(o[n]=e[n]);if("object"==typeof t)for(n in t)s.call(t,n)&&(o[n]=t[n]);return o}function s(e){function t(){var e;if("success"===p)for(;e=l.pop();)e(k.response,k);else for(;e=f.pop();)e(k)}function n(){return p&&t(),d}var s=o({url:null,postData:null,sign:!0},e),i=r(),u=s.postData?"POST":"GET",l=[],f=[],p=null,k={response:null},T=!0,d={};return/^http/.test(s.url)||(s.url=a.prefixUrl+s.url),d.success=function(e){return l.push(e),n()},d.fail=function(e){return f.push(e),n()},i?(d.req=i,i.open(u,s.url,!0),c.token&&s.sign&&i.setRequestHeader("x-snd-apisignature",c.token),s.postData&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T&&i.setRequestHeader("Accept","application/javascript, application/json"),i.onreadystatechange=function(){4===i.readyState&&(200!==i.status&&304!==i.status?(p="fail",k={statusCode:i.status,statusText:i.statusText,response:i.responseText}):(p="success",k={statusCode:i.status,statusText:i.statusText,response:i.responseText},"application/json"===i.getResponseHeader("Content-Type")&&JSON&&(k.response=JSON.parse(k.response))),t())},4===i.readyState?void(console&&console.warn("I did not expect to get here")):(i.send(s.postData),d)):(p="fail",d)}function r(){for(var e=!1,t=0;t<p.length;t++){try{e=p[t]()}catch(n){continue}break}return e}function i(){mno.test.schedule("SNDAPI.js",{getToken:function(){return c.token},getTokenTimer:function(){return c.tokenTimer}})}var u,a=o({refreshInterval:18e5,signatureServiceUrl:"http://apitestbeta3.medianorge.no/sts/signature",prefixUrl:"http://api.snd.no/news/v2/",key:null},e),c={token:null,tokenTimer:null},l=function(e){console.log(e)},f=function(e){console.error(e)},p=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];return u={init:t,ajax:s},mno&&mno.test&&mno.test.now&&(u.test=i),u};mno&&mno.test&&mno.test.now&&!function(){"use strict";mno.test.register({id:"SNDAPI.js",suite:function(e){test("refresh token initializes",function(t){t.ok(!!e.getTokenTimer(),"token timer is set")}),asyncTest("we get a token",function(t){function n(){return e.getToken()?(t.ok(!0,"token set"),void start()):void setTimeout(n,100)}expect(1),n()}),asyncTest("we can make a request with this token",function(){expect(1),t.ajax({url:"publication/common/sections/1/auto"}).success(function(e){console.log(e),ok(e,"data received")}).fail(function(e){console.error("request failed"),console.error(e)})})}});var e="afLKmZNSMrZybha2zsp9YNhB",t=new SNDAPI({key:e});t.init(),t.test()}();